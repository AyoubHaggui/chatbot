# chatbot
Facebook chatbot with NodeJs mongoose and DialogFlow
<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [channel](#channel)
-   [readWebhookEvent](#readwebhookevent)
-   [messagesGenerator](#messagesgenerator)
-   [eventsGenerator](#eventsgenerator)
-   [textMessage](#textmessage)
-   [analyse](#analyse)
-   [create](#create)
-   [create](#create-1)
-   [create](#create-2)
-   [cityGenerator](#citygenerator)
-   [cityCollectionExists](#citycollectionexists)
-   [getUserDetails](#getuserdetails)
-   [read](#read)
-   [updateUserMessages](#updateusermessages)
-   [connect](#connect)

## channel

Decides which module should respond to the req depending on the contents of req.

**Parameters**

-   `req` **[JSON](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON)** request
-   `res` **[JSON](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON)** response

## readWebhookEvent

Extract the webhook type

**Parameters**

-   `event` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** event content

Returns **[String](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** event type

## messagesGenerator

Loops over the messages

**Parameters**

-   `messaging` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** array of messages

## eventsGenerator

Loops over the events

**Parameters**

-   `entry` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** array of events

## textMessage

Registers user and message to database & sends message for analysis

**Parameters**

-   `messaging` **[JSON](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON)** messaging event request

## analyse

Uses apiai module to analyse input text

**Parameters**

-   `sender` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** Session id used to keep track of context in apiai
-   `text` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** text to analyse

## create

Load the Tunisian city list from reference file to database

## create

Add new message to database

**Parameters**

-   `message_details` **[object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** The new message key/fields pairs

## create

Creates new user or update existing users messages list

**Parameters**

-   `user_details` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** new user details according to user schema
-   `message_details` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** new message details

## cityGenerator

Iterate over the list of cities from reference file

## cityCollectionExists

Look for cities collection in he current database

Returns **[object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Resolves with true if the cities collection exists

## getUserDetails

Uses facebook API to request details about the user

**Parameters**

-   `PSID` **[string](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String)** user unique id

Returns **[object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** a promise that resolves with the user details

## read

Read user from database

**Parameters**

-   `user` **[object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** User model
-   `user_details` **[object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** The user to retreive from database

Returns **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** User object if user exists or null otherwise

## updateUserMessages

Adds a message to an existing user messages list

**Parameters**

-   `user` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** User database model
-   `user_details` **[Object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** User to which add the message details
-   `message_details` **[object](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object)** Message to add to user

## connect

Generates database connection and diconnects on process termination
